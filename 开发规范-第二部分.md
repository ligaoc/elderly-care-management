# RuoYi-Vue-Plus 开发规范完整指南（续）

## 二、后端开发规范（续）

### 2.6 Controller（控制层）规范

**完整示例**:
```java
@Validated
@RequiredArgsConstructor
@RestController
@RequestMapping("/demo/demo")
public class TestDemoController extends BaseController {

    private final ITestDemoService testDemoService;

    /**
     * 查询测试单表列表
     */
    @SaCheckPermission("demo:demo:list")
    @GetMapping("/list")
    public TableDataInfo<TestDemoVo> list(@Validated(QueryGroup.class) TestDemoBo bo, 
                                          PageQuery pageQuery) {
        return testDemoService.queryPageList(bo, pageQuery);
    }

    /**
     * 获取测试单表详细信息
     *
     * @param id 测试ID
     */
    @SaCheckPermission("demo:demo:query")
    @GetMapping("/{id}")
    public R<TestDemoVo> getInfo(@NotNull(message = "主键不能为空")
                                 @PathVariable("id") Long id) {
        return R.ok(testDemoService.queryById(id));
    }

    /**
     * 新增测试单表
     */
    @SaCheckPermission("demo:demo:add")
    @Log(title = "测试单表", businessType = BusinessType.INSERT)
    @RepeatSubmit(interval = 2, timeUnit = TimeUnit.SECONDS, message = "{repeat.submit.message}")
    @PostMapping()
    public R<Void> add(@RequestBody TestDemoBo bo) {
        ValidatorUtils.validate(bo, AddGroup.class);
        return toAjax(testDemoService.insertByBo(bo));
    }

    /**
     * 修改测试单表
     */
    @SaCheckPermission("demo:demo:edit")
    @Log(title = "测试单表", businessType = BusinessType.UPDATE)
    @RepeatSubmit
    @PutMapping()
    public R<Void> edit(@Validated(EditGroup.class) @RequestBody TestDemoBo bo) {
        return toAjax(testDemoService.updateByBo(bo));
    }

    /**
     * 删除测试单表
     *
     * @param ids 测试ID串
     */
    @SaCheckPermission("demo:demo:remove")
    @Log(title = "测试单表", businessType = BusinessType.DELETE)
    @DeleteMapping("/{ids}")
    public R<Void> remove(@NotEmpty(message = "主键不能为空")
                          @PathVariable Long[] ids) {
        return toAjax(testDemoService.deleteWithValidByIds(Arrays.asList(ids), true));
    }

    /**
     * 导出测试单表列表
     */
    @SaCheckPermission("demo:demo:export")
    @Log(title = "测试单表", businessType = BusinessType.EXPORT)
    @PostMapping("/export")
    public void export(@Validated TestDemoBo bo, HttpServletResponse response) {
        List<TestDemoVo> list = testDemoService.queryList(bo);
        ExcelUtil.exportExcel(list, "测试单表", TestDemoVo.class, response);
    }

    /**
     * 导入数据
     */
    @Log(title = "测试单表", businessType = BusinessType.IMPORT)
    @SaCheckPermission("demo:demo:import")
    @PostMapping(value = "/importData", consumes = MediaType.MULTIPART_FORM_DATA_VALUE)
    public R<Void> importData(@RequestPart("file") MultipartFile file) throws Exception {
        ExcelResult<TestDemoImportVo> excelResult = ExcelUtil.importExcel(file.getInputStream(), 
                                                                           TestDemoImportVo.class, true);
        List<TestDemo> list = MapstructUtils.convert(excelResult.getList(), TestDemo.class);
        testDemoService.saveBatch(list);
        return R.ok(excelResult.getAnalysis());
    }
}
```

**规范要点**:
- 继承 `BaseController` 获得基础方法
- 使用 `@SaCheckPermission` 进行权限校验
- 使用 `@Log` 记录操作日志
- 使用 `@RepeatSubmit` 防止重复提交
- 使用 `@Validated` 进行参数校验
- 返回类型使用 `R<T>` 包装响应
- 使用 `TableDataInfo<T>` 包装分页数据
- 使用 `toAjax()` 方法转换操作结果

### 2.7 BO/VO 规范

**Business Object (BO) - 业务对象**:
```java
@Data
public class TestDemoBo extends BaseEntity {
    
    /**
     * 主键
     */
    private Long id;

    /**
     * 部门id
     */
    private Long deptId;

    /**
     * 用户id
     */
    private Long userId;

    /**
     * 排序号
     */
    private Integer orderNum;

    /**
     * key键
     */
    private String testKey;

    /**
     * 值
     */
    private String value;
}
```

**Value Object (VO) - 值对象**:
```java
@Data
public class TestDemoVo {
    
    /**
     * 主键
     */
    private Long id;

    /**
     * 部门id
     */
    private Long deptId;

    /**
     * 用户id
     */
    private Long userId;

    /**
     * 排序号
     */
    private Integer orderNum;

    /**
     * key键
     */
    private String testKey;

    /**
     * 值
     */
    private String value;
}
```

**规范要点**:
- BO 用于接收前端请求参数
- VO 用于返回给前端的数据
- 使用 MapStruct 进行对象转换
- 添加 JavaDoc 注释说明字段含义

---

## 三、数据库规范

### 3.1 表命名规范

**规则**:
- 表名使用小写字母和下划线
- 表名前缀表示模块: `sys_` (系统), `test_` (测试), `demo_` (演示)
- 表名使用单数形式

**示例**:
```sql
-- 系统表
sys_user          -- 用户表
sys_dept          -- 部门表
sys_role          -- 角色表
sys_menu          -- 菜单表

-- 测试表
test_demo         -- 测试单表
test_tree         -- 测试树表

-- 业务表
business_order    -- 订单表
business_product  -- 产品表
```

### 3.2 字段命名规范

**规则**:
- 字段名使用小写字母和下划线
- 主键统一使用 `id` 或 `{表名}_id`
- 外键使用 `{关联表名}_id`
- 布尔字段使用 `is_` 前缀
- 时间字段使用 `_time` 或 `_date` 后缀
- 状态字段使用 `status` 或 `state`

**示例**:
```sql
CREATE TABLE test_demo (
    id              BIGINT          NOT NULL        COMMENT '主键',
    dept_id         BIGINT          NOT NULL        COMMENT '部门ID',
    user_id         BIGINT          NOT NULL        COMMENT '用户ID',
    test_key        VARCHAR(100)    NOT NULL        COMMENT 'key键',
    value           VARCHAR(500)                    COMMENT '值',
    order_num       INT             DEFAULT 0       COMMENT '排序号',
    status          CHAR(1)         DEFAULT '0'     COMMENT '状态（0正常 1停用）',
    is_deleted      TINYINT(1)      DEFAULT 0       COMMENT '是否删除',
    version         BIGINT          DEFAULT 1       COMMENT '版本号',
    del_flag        CHAR(1)         DEFAULT '0'     COMMENT '删除标志（0代表存在 1代表删除）',
    create_dept     BIGINT                          COMMENT '创建部门',
    create_by       BIGINT                          COMMENT '创建者',
    create_time     DATETIME                        COMMENT '创建时间',
    update_by       BIGINT                          COMMENT '更新者',
    update_time     DATETIME                        COMMENT '更新时间',
    tenant_id       VARCHAR(20)     DEFAULT '000000' COMMENT '租户编号',
    PRIMARY KEY (id)
) ENGINE=INNODB COMMENT='测试单表';
```

### 3.3 字段类型规范

| 字段类型 | 用途 | 示例 |
|---------|------|------|
| BIGINT | 主键、外键、大整数 | id, user_id, count |
| INT | 普通整数 | age, order_num |
| VARCHAR(n) | 字符串 | name, email, phone |
| CHAR(1) | 状态、标志 | status, del_flag |
| TINYINT(1) | 布尔值 | is_deleted, is_active |
| DECIMAL(10,2) | 金额 | price, amount |
| DATETIME | 时间戳 | create_time, update_time |
| TEXT | 长文本 | description, content |
| JSON | JSON数据 | extra_data |

### 3.4 公共字段规范

所有表都应包含以下公共字段:

```sql
-- 租户字段（多租户支持）
tenant_id       VARCHAR(20)     DEFAULT '000000' COMMENT '租户编号',

-- 审计字段
create_dept     BIGINT                          COMMENT '创建部门',
create_by       BIGINT                          COMMENT '创建者',
create_time     DATETIME                        COMMENT '创建时间',
update_by       BIGINT                          COMMENT '更新者',
update_time     DATETIME                        COMMENT '更新时间',

-- 逻辑删除
del_flag        CHAR(1)         DEFAULT '0'     COMMENT '删除标志（0代表存在 1代表删除）',

-- 乐观锁
version         BIGINT          DEFAULT 1       COMMENT '版本号',
```

---

## 四、前端开发规范

### 4.1 项目结构

```
plus-ui/src/
├── api/                    # API接口层
│   ├── demo/
│   │   ├── demo/
│   │   │   ├── index.ts    # API方法
│   │   │   └── types.ts    # 类型定义
│   │   └── tree/
│   ├── system/
│   ├── monitor/
│   └── types.ts            # 全局类型
├── views/                  # 页面组件
│   ├── demo/
│   │   ├── demo/
│   │   │   └── index.vue
│   │   └── tree/
│   ├── system/
│   ├── monitor/
│   └── login.vue
├── components/             # 公共组件
├── store/                  # Pinia状态管理
├── router/                 # 路由配置
├── utils/                  # 工具函数
├── hooks/                  # 自定义Hook
├── directive/              # 自定义指令
├── types/                  # 全局类型定义
├── layout/                 # 布局组件
├── plugins/                # 插件
├── App.vue
└── main.ts
```

### 4.2 API 接口规范

**API 方法定义** (`plus-ui/src/api/demo/demo/index.ts`):
```typescript
import request from '@/utils/request';
import { AxiosPromise } from 'axios';
import { DemoVO, DemoForm, DemoQuery } from '@/api/demo/demo/types';

/**
 * 查询测试单列表
 * @param query
 * @returns {*}
 */
export const listDemo = (query?: DemoQuery): AxiosPromise<DemoVO[]> => {
  return request({
    url: '/demo/demo/list',
    method: 'get',
    params: query
  });
};

/**
 * 查询测试单详细
 * @param id
 */
export const getDemo = (id: string | number): AxiosPromise<DemoVO> => {
  return request({
    url: '/demo/demo/' + id,
    method: 'get'
  });
};

/**
 * 新增测试单
 * @param data
 */
export const addDemo = (data: DemoForm) => {
  return request({
    url: '/demo/demo',
    method: 'post',
    data: data
  });
};

/**
 * 修改测试单
 * @param data
 */
export const updateDemo = (data: DemoForm) => {
  return request({
    url: '/demo/demo',
    method: 'put',
    data: data
  });
};

/**
 * 删除测试单
 * @param id
 */
export const delDemo = (id: string | number | Array<string | number>) => {
  return request({
    url: '/demo/demo/' + id,
    method: 'delete'
  });
};
```

**规范要点**:
- 使用 `request` 工具进行HTTP请求
- 返回类型使用 `AxiosPromise<T>`
- 使用 JSDoc 注释说明参数和返回值
- 方法名使用驼峰命名
- 按照 RESTful 规范设计URL

### 4.3 类型定义规范

**类型文件** (`plus-ui/src/api/demo/demo/types.ts`):
```typescript
export interface DemoVO {
  /**
   * 主键
   */
  id: string | number;

  /**
   * 部门id
   */
  deptId: string | number;

  /**
   * 用户id
   */
  userId: string | number;

  /**
   * 排序号
   */
  orderNum: number;

  /**
   * key键
   */
  testKey: string;

  /**
   * 值
   */
  value: string;
}

export interface DemoForm extends BaseEntity {
  /**
   * 主键
   */
  id?: string | number;

  /**
   * 部门id
   */
  deptId?: string | number;

  /**
   * 用户id
   */
  userId?: string | number;

  /**
   * 排序号
   */
  orderNum?: number;

  /**
   * key键
   */
  testKey?: string;

  /**
   * 值
   */
  value?: string;
}

export interface DemoQuery extends PageQuery {
  /**
   * 部门id
   */
  deptId?: string | number;

  /**
   * 用户id
   */
  userId?: string | number;

  /**
   * 排序号
   */
  orderNum?: number;

  /**
   * key键
   */
  testKey?: string;

  /**
   * 值
   */
  value?: string;
}
```

**规范要点**:
- VO: 后端返回的数据结构
- Form: 表单提交的数据结构
- Query: 查询条件的数据结构
- 所有字段添加 JSDoc 注释
- 可选字段使用 `?` 标记

