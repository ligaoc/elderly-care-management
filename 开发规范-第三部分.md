# RuoYi-Vue-Plus 开发规范完整指南（续）

## 四、前端开发规范（续）

### 4.4 Vue 组件规范

**完整示例** (`plus-ui/src/views/demo/demo/index.vue`):
```vue
<template>
  <div class="p-2">
    <!-- 搜索表单 -->
    <transition :enter-active-class="proxy?.animate.searchAnimate.enter" 
                :leave-active-class="proxy?.animate.searchAnimate.leave">
      <div v-show="showSearch" class="mb-[10px]">
        <el-card shadow="hover">
          <el-form ref="queryFormRef" :model="queryParams" :inline="true">
            <el-form-item label="key键" prop="testKey">
              <el-input v-model="queryParams.testKey" placeholder="请输入key键" 
                        clearable @keyup.enter="handleQuery" />
            </el-form-item>
            <el-form-item label="值" prop="value">
              <el-input v-model="queryParams.value" placeholder="请输入值" 
                        clearable @keyup.enter="handleQuery" />
            </el-form-item>
            <el-form-item>
              <el-button type="primary" icon="Search" @click="handleQuery">搜索</el-button>
              <el-button icon="Refresh" @click="resetQuery">重置</el-button>
            </el-form-item>
          </el-form>
        </el-card>
      </div>
    </transition>

    <!-- 数据表格 -->
    <el-card shadow="hover">
      <template #header>
        <el-row :gutter="10" class="mb8">
          <el-col :span="1.5">
            <el-button v-hasPermi="['demo:demo:add']" type="primary" plain icon="Plus" 
                       @click="handleAdd">新增</el-button>
          </el-col>
          <el-col :span="1.5">
            <el-button v-hasPermi="['demo:demo:edit']" type="success" plain icon="Edit" 
                       :disabled="single" @click="handleUpdate()">修改</el-button>
          </el-col>
          <el-col :span="1.5">
            <el-button v-hasPermi="['demo:demo:remove']" type="danger" plain icon="Delete" 
                       :disabled="multiple" @click="handleDelete()">删除</el-button>
          </el-col>
          <el-col :span="1.5">
            <el-button v-hasPermi="['demo:demo:export']" type="warning" plain icon="Download" 
                       @click="handleExport">导出</el-button>
          </el-col>
          <right-toolbar v-model:show-search="showSearch" @query-table="getList"></right-toolbar>
        </el-row>
      </template>

      <el-table v-loading="loading" border :data="demoList" @selection-change="handleSelectionChange">
        <el-table-column type="selection" width="55" align="center" />
        <el-table-column v-if="true" label="主键" align="center" prop="id" />
        <el-table-column label="部门id" align="center" prop="deptId" />
        <el-table-column label="用户id" align="center" prop="userId" />
        <el-table-column label="排序号" align="center" prop="orderNum" />
        <el-table-column label="key键" align="center" prop="testKey" />
        <el-table-column label="值" align="center" prop="value" />
        <el-table-column label="操作" align="center" class-name="small-padding fixed-width">
          <template #default="scope">
            <el-tooltip content="修改" placement="top">
              <el-button v-hasPermi="['demo:demo:edit']" link type="primary" icon="Edit" 
                         @click="handleUpdate(scope.row)"></el-button>
            </el-tooltip>
            <el-tooltip content="删除" placement="top">
              <el-button v-hasPermi="['demo:demo:remove']" link type="primary" icon="Delete" 
                         @click="handleDelete(scope.row)"></el-button>
            </el-tooltip>
          </template>
        </el-table-column>
      </el-table>

      <pagination v-show="total > 0" v-model:page="queryParams.pageNum" 
                  v-model:limit="queryParams.pageSize" :total="total" @pagination="getList" />
    </el-card>

    <!-- 添加或修改对话框 -->
    <el-dialog v-model="dialog.visible" :title="dialog.title" width="500px" append-to-body>
      <el-form ref="demoFormRef" :model="form" :rules="rules" label-width="80px">
        <el-form-item label="部门id" prop="deptId">
          <el-input v-model="form.deptId" placeholder="请输入部门id" />
        </el-form-item>
        <el-form-item label="用户id" prop="userId">
          <el-input v-model="form.userId" placeholder="请输入用户id" />
        </el-form-item>
        <el-form-item label="排序号" prop="orderNum">
          <el-input v-model="form.orderNum" placeholder="请输入排序号" />
        </el-form-item>
        <el-form-item label="key键" prop="testKey">
          <el-input v-model="form.testKey" placeholder="请输入key键" />
        </el-form-item>
        <el-form-item label="值" prop="value">
          <el-input v-model="form.value" placeholder="请输入值" />
        </el-form-item>
      </el-form>
      <template #footer>
        <div class="dialog-footer">
          <el-button :loading="buttonLoading" type="primary" @click="submitForm">确 定</el-button>
          <el-button @click="cancel">取 消</el-button>
        </div>
      </template>
    </el-dialog>
  </div>
</template>

<script setup name="Demo" lang="ts">
import { listDemo, getDemo, delDemo, addDemo, updateDemo } from '@/api/demo/demo';
import { DemoVO, DemoQuery, DemoForm } from '@/api/demo/demo/types';

const { proxy } = getCurrentInstance() as ComponentInternalInstance;

// 数据定义
const demoList = ref<DemoVO[]>([]);
const buttonLoading = ref(false);
const loading = ref(true);
const showSearch = ref(true);
const ids = ref<Array<string | number>>([]);
const single = ref(true);
const multiple = ref(true);
const total = ref(0);

// 表单引用
const queryFormRef = ref<ElFormInstance>();
const demoFormRef = ref<ElFormInstance>();

// 对话框配置
const dialog = reactive<DialogOption>({
  visible: false,
  title: ''
});

// 初始化表单数据
const initFormData: DemoForm = {
  id: undefined,
  deptId: undefined,
  userId: undefined,
  orderNum: undefined,
  testKey: undefined,
  value: undefined
};

// 响应式数据
const data = reactive<PageData<DemoForm, DemoQuery>>({
  form: { ...initFormData },
  queryParams: {
    pageNum: 1,
    pageSize: 10,
    deptId: undefined,
    userId: undefined,
    orderNum: undefined,
    testKey: undefined,
    value: undefined
  },
  rules: {
    id: [{ required: true, message: '主键不能为空', trigger: 'blur' }],
    deptId: [{ required: true, message: '部门id不能为空', trigger: 'blur' }],
    userId: [{ required: true, message: '用户id不能为空', trigger: 'blur' }],
    orderNum: [{ required: true, message: '排序号不能为空', trigger: 'blur' }],
    testKey: [{ required: true, message: 'key键不能为空', trigger: 'blur' }],
    value: [{ required: true, message: '值不能为空', trigger: 'blur' }]
  }
});

const { queryParams, form, rules } = toRefs(data);

/** 查询列表 */
const getList = async () => {
  loading.value = true;
  const res = await listDemo(queryParams.value);
  demoList.value = res.rows;
  total.value = res.total;
  loading.value = false;
};

/** 取消按钮 */
const cancel = () => {
  reset();
  dialog.visible = false;
};

/** 表单重置 */
const reset = () => {
  form.value = { ...initFormData };
  demoFormRef.value?.resetFields();
};

/** 搜索按钮操作 */
const handleQuery = () => {
  queryParams.value.pageNum = 1;
  getList();
};

/** 重置按钮操作 */
const resetQuery = () => {
  queryFormRef.value?.resetFields();
  handleQuery();
};

/** 多选框选中数据 */
const handleSelectionChange = (selection: DemoVO[]) => {
  ids.value = selection.map((item) => item.id);
  single.value = selection.length != 1;
  multiple.value = !selection.length;
};

/** 新增按钮操作 */
const handleAdd = () => {
  reset();
  dialog.visible = true;
  dialog.title = '添加测试单';
};

/** 修改按钮操作 */
const handleUpdate = async (row?: DemoVO) => {
  reset();
  const _id = row?.id || ids.value[0];
  const res = await getDemo(_id);
  Object.assign(form.value, res.data);
  dialog.visible = true;
  dialog.title = '修改测试单';
};

/** 提交按钮 */
const submitForm = () => {
  demoFormRef.value?.validate(async (valid: boolean) => {
    if (valid) {
      buttonLoading.value = true;
      if (form.value.id) {
        await updateDemo(form.value).finally(() => (buttonLoading.value = false));
      } else {
        await addDemo(form.value).finally(() => (buttonLoading.value = false));
      }
      proxy?.$modal.msgSuccess('修改成功');
      dialog.visible = false;
      await getList();
    }
  });
};

/** 删除按钮操作 */
const handleDelete = async (row?: DemoVO) => {
  const _ids = row?.id || ids.value;
  await proxy?.$modal.confirm('是否确认删除测试单编号为"' + _ids + '"的数据项？')
    .finally(() => (loading.value = false));
  await delDemo(_ids);
  proxy?.$modal.msgSuccess('删除成功');
  await getList();
};

/** 导出按钮操作 */
const handleExport = () => {
  proxy?.download(
    'demo/demo/export',
    {
      ...queryParams.value
    },
    `demo_${new Date().getTime()}.xlsx`
  );
};

/** 页面加载 */
onMounted(() => {
  getList();
});
</script>
```

**规范要点**:
- 使用 `<script setup>` 语法
- 使用 `ref` 和 `reactive` 管理状态
- 使用 `toRefs` 解构响应式对象
- 使用 `v-hasPermi` 指令进行权限控制
- 使用 `v-loading` 显示加载状态
- 使用 `el-dialog` 实现弹窗
- 使用 `el-form` 进行表单验证
- 使用 `el-table` 显示数据列表
- 使用 `pagination` 组件进行分页
- 异步操作使用 `async/await`

### 4.5 命名规范

**文件和文件夹**:
- 文件夹使用小写字母和中划线: `demo-list`, `user-info`
- Vue 文件使用 PascalCase: `DemoList.vue`, `UserInfo.vue`
- TypeScript 文件使用 camelCase: `demoApi.ts`, `userService.ts`

**变量和函数**:
- 常量使用 UPPER_SNAKE_CASE: `MAX_SIZE`, `DEFAULT_PAGE_SIZE`
- 变量使用 camelCase: `demoList`, `isLoading`
- 函数使用 camelCase: `handleQuery()`, `getList()`
- 事件处理函数使用 `handle` 前缀: `handleAdd()`, `handleDelete()`
- 获取数据的函数使用 `get` 前缀: `getList()`, `getInfo()`

**CSS 类名**:
- 使用 BEM 命名法: `demo-list`, `demo-list__item`, `demo-list__item--active`
- 使用 UnoCSS 原子类: `p-2`, `mb-[10px]`, `flex`, `justify-center`

---

## 五、权限和认证规范

### 5.1 权限注解

**后端权限控制**:
```java
// 检查权限
@SaCheckPermission("demo:demo:list")
public TableDataInfo<TestDemoVo> list(...) { }

// 检查角色
@SaCheckRole("admin")
public R<Void> add(...) { }

// 检查登录
@SaCheckLogin
public R<Void> edit(...) { }

// 复杂权限表达式
@SaCheckPermission(value = {"demo:demo:add", "demo:demo:edit"}, mode = SaMode.OR)
public R<Void> save(...) { }
```

**前端权限控制**:
```vue
<!-- 权限指令 -->
<el-button v-hasPermi="['demo:demo:add']" @click="handleAdd">新增</el-button>

<!-- 角色指令 -->
<el-button v-hasRole="['admin']" @click="handleAdmin">管理</el-button>

<!-- 权限判断 -->
<div v-if="$hasPermi(['demo:demo:edit'])">
  <el-button @click="handleEdit">编辑</el-button>
</div>
```

### 5.2 数据权限

**后端数据权限**:
```java
@DataPermission({
    @DataColumn(key = "deptName", value = "dept_id"),
    @DataColumn(key = "userName", value = "user_id")
})
Page<TestDemoVo> customPageList(@Param("page") Page<TestDemo> page, 
                                 @Param("ew") Wrapper<TestDemo> wrapper);
```

---

## 六、常用工具和方法

### 6.1 后端工具类

**MapstructUtils - 对象转换**:
```java
// 单个对象转换
TestDemo entity = MapstructUtils.convert(bo, TestDemo.class);

// 列表转换
List<TestDemo> list = MapstructUtils.convert(boList, TestDemo.class);
```

**StringUtils - 字符串工具**:
```java
// 判断非空
if (StringUtils.isNotBlank(str)) { }

// 判断为空
if (StringUtils.isBlank(str)) { }
```

**ValidatorUtils - 校验工具**:
```java
// 校验对象
ValidatorUtils.validate(bo, AddGroup.class);
```

**ExcelUtil - Excel工具**:
```java
// 导出Excel
ExcelUtil.exportExcel(list, "测试单表", TestDemoVo.class, response);

// 导入Excel
ExcelResult<TestDemoImportVo> result = ExcelUtil.importExcel(
    file.getInputStream(), TestDemoImportVo.class, true);
```

### 6.2 前端工具类

**request - HTTP请求**:
```typescript
import request from '@/utils/request';

// GET请求
request({ url: '/api/demo', method: 'get', params: {} });

// POST请求
request({ url: '/api/demo', method: 'post', data: {} });

// PUT请求
request({ url: '/api/demo', method: 'put', data: {} });

// DELETE请求
request({ url: '/api/demo', method: 'delete' });
```

**dict - 字典工具**:
```typescript
import { getDictLabel, getDictOptions } from '@/utils/dict';

// 获取字典标签
const label = getDictLabel('sys_user_sex', '0');

// 获取字典选项
const options = getDictOptions('sys_user_sex');
```

**auth - 权限工具**:
```typescript
import { hasPermi, hasRole } from '@/utils/auth';

// 检查权限
if (hasPermi(['demo:demo:add'])) { }

// 检查角色
if (hasRole(['admin'])) { }
```

---

## 七、常见问题和最佳实践

### 7.1 CRUD 操作流程

1. **新增流程**:
   - 前端表单验证 → 调用 API → 后端参数校验 → 业务逻辑处理 → 数据库插入 → 返回结果

2. **修改流程**:
   - 前端加载数据 → 表单修改 → 调用 API → 后端参数校验 → 业务逻辑处理 → 数据库更新 → 返回结果

3. **删除流程**:
   - 前端确认删除 → 调用 API → 后端权限校验 → 业务逻辑处理 → 数据库删除 → 返回结果

4. **查询流程**:
   - 前端输入查询条件 → 调用 API → 后端构建查询条件 → 数据库查询 → 返回分页结果

### 7.2 最佳实践

1. **使用 BO/VO 分离**:
   - BO 用于接收请求参数
   - VO 用于返回响应数据
   - Entity 用于数据库操作

2. **使用 MapStruct 进行对象转换**:
   - 避免手动赋值
   - 提高代码可维护性

3. **使用 Lambda 表达式构建查询条件**:
   - 类型安全
   - 代码简洁

4. **使用权限注解进行权限控制**:
   - 声明式权限控制
   - 代码清晰

5. **使用数据权限注解进行数据过滤**:
   - 自动过滤用户无权限的数据
   - 提高安全性

6. **使用 @Log 注解记录操作日志**:
   - 自动记录用户操作
   - 便于审计

7. **使用 @RepeatSubmit 防止重复提交**:
   - 避免重复操作
   - 提高用户体验

8. **使用 @Validated 进行参数校验**:
   - 自动校验参数
   - 减少代码量

