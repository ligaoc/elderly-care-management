# RuoYi-Vue-Plus 开发规范完整指南

## 一、项目概述

### 1.1 框架特点
- **前端**: Vue3 + TypeScript + Element Plus + Vite
- **后端**: Spring Boot 3.5 + MyBatis-Plus + Sa-Token
- **数据库**: MySQL/Oracle/PostgreSQL/SQLServer（支持多数据源）
- **架构**: 分布式集群 + 多租户支持
- **版本**: 5.5.2

### 1.2 核心技术栈

**后端依赖**:
- Spring Boot 3.5.9
- MyBatis-Plus 3.5.14
- Sa-Token 1.44.0 (权限认证)
- Redisson 3.52.0 (Redis客户端)
- Hutool 5.8.40 (工具库)
- Lombok 1.18.40
- MapStruct-Plus 1.5.0 (对象转换)

**前端依赖**:
- Vue 3.5.22
- TypeScript 5.9.3
- Element Plus 2.11.7
- Pinia 3.0.3 (状态管理)
- Vue Router 4.6.3
- Axios 1.13.1
- UnoCSS 66.5.4 (原子化CSS)

---

## 二、后端开发规范

### 2.1 项目结构

```
RuoYi-Vue-Plus/
├── ruoyi-admin/              # 主应用入口
├── ruoyi-common/             # 公共组件库
│   ├── ruoyi-common-core/    # 核心工具
│   ├── ruoyi-common-mybatis/ # MyBatis扩展
│   ├── ruoyi-common-redis/   # Redis支持
│   ├── ruoyi-common-satoken/ # 权限认证
│   ├── ruoyi-common-web/     # Web支持
│   ├── ruoyi-common-excel/   # Excel导入导出
│   ├── ruoyi-common-log/     # 日志记录
│   └── ...其他公共模块
├── ruoyi-modules/            # 业务模块
│   ├── ruoyi-system/         # 系统管理模块
│   ├── ruoyi-demo/           # 示例模块
│   ├── ruoyi-job/            # 定时任务模块
│   ├── ruoyi-generator/      # 代码生成模块
│   └── ruoyi-workflow/       # 工作流模块
└── ruoyi-extend/             # 扩展模块
```

### 2.2 单个模块的标准结构

```
ruoyi-demo/
├── src/main/java/org/dromara/demo/
│   ├── controller/           # 控制层
│   │   └── TestDemoController.java
│   ├── service/              # 业务层
│   │   ├── ITestDemoService.java
│   │   └── impl/
│   │       └── TestDemoServiceImpl.java
│   ├── mapper/               # 数据访问层
│   │   └── TestDemoMapper.java
│   ├── domain/               # 领域模型
│   │   ├── TestDemo.java     # Entity
│   │   ├── bo/
│   │   │   └── TestDemoBo.java    # Business Object
│   │   └── vo/
│   │       └── TestDemoVo.java    # Value Object
│   └── config/               # 配置类
└── src/main/resources/
    └── mapper/               # MyBatis XML映射文件
        └── demo/
            └── TestDemoMapper.xml
```

### 2.3 Entity（数据库实体）规范

**示例代码**:
```java
@Data
@EqualsAndHashCode(callSuper = true)
@TableName("test_demo")
public class TestDemo extends TenantEntity {
    
    @Serial
    private static final long serialVersionUID = 1L;

    /**
     * 主键
     */
    @TableId(value = "id")
    private Long id;

    /**
     * 部门id
     */
    private Long deptId;

    /**
     * 用户id
     */
    private Long userId;

    /**
     * 排序号
     */
    @OrderBy(asc = false, sort = 1)
    private Integer orderNum;

    /**
     * key键
     */
    private String testKey;

    /**
     * 值
     */
    private String value;

    /**
     * 版本（乐观锁）
     */
    @Version
    private Long version;

    /**
     * 删除标志
     */
    @TableLogic
    private Long delFlag;
}
```

**规范要点**:
- 继承 `TenantEntity` (支持多租户)
- 使用 `@TableName` 指定表名
- 使用 `@TableId` 指定主键
- 使用 `@Version` 标记乐观锁字段
- 使用 `@TableLogic` 标记逻辑删除字段
- 使用 `@OrderBy` 指定排序
- 所有字段添加JavaDoc注释

### 2.4 Mapper（数据访问层）规范

**示例代码**:
```java
public interface TestDemoMapper extends BaseMapperPlus<TestDemo, TestDemoVo> {

    @DataPermission({
        @DataColumn(key = "deptName", value = "dept_id"),
        @DataColumn(key = "userName", value = "user_id")
    })
    Page<TestDemoVo> customPageList(@Param("page") Page<TestDemo> page, 
                                     @Param("ew") Wrapper<TestDemo> wrapper);

    @Override
    @DataPermission({
        @DataColumn(key = "deptName", value = "dept_id"),
        @DataColumn(key = "userName", value = "user_id")
    })
    default <P extends IPage<TestDemoVo>> P selectVoPage(IPage<TestDemo> page, 
                                                          Wrapper<TestDemo> wrapper) {
        return selectVoPage(page, wrapper, this.currentVoClass());
    }
}
```

**规范要点**:
- 继承 `BaseMapperPlus<Entity, Vo>` 获得CRUD基础方法
- 使用 `@DataPermission` 注解实现数据权限控制
- 使用 `@DataColumn` 指定权限字段映射
- 自定义查询方法使用 `@Param` 注解
- 支持 Lambda 查询和 Wrapper 条件构造

### 2.5 Service（业务层）规范

**接口定义**:
```java
public interface ITestDemoService {
    
    /**
     * 查询单个
     */
    TestDemoVo queryById(Long id);

    /**
     * 查询列表
     */
    TableDataInfo<TestDemoVo> queryPageList(TestDemoBo bo, PageQuery pageQuery);

    /**
     * 自定义分页查询
     */
    TableDataInfo<TestDemoVo> customPageList(TestDemoBo bo, PageQuery pageQuery);

    /**
     * 查询列表
     */
    List<TestDemoVo> queryList(TestDemoBo bo);

    /**
     * 新增
     */
    Boolean insertByBo(TestDemoBo bo);

    /**
     * 修改
     */
    Boolean updateByBo(TestDemoBo bo);

    /**
     * 删除
     */
    Boolean deleteWithValidByIds(Collection<Long> ids, Boolean isValid);

    /**
     * 批量保存
     */
    Boolean saveBatch(List<TestDemo> list);
}
```

**实现类**:
```java
@RequiredArgsConstructor
@Service
public class TestDemoServiceImpl implements ITestDemoService {

    private final TestDemoMapper baseMapper;

    @Override
    public TestDemoVo queryById(Long id) {
        return baseMapper.selectVoById(id);
    }

    @Override
    public TableDataInfo<TestDemoVo> queryPageList(TestDemoBo bo, PageQuery pageQuery) {
        LambdaQueryWrapper<TestDemo> lqw = buildQueryWrapper(bo);
        Page<TestDemoVo> result = baseMapper.selectVoPage(pageQuery.build(), lqw);
        return TableDataInfo.build(result);
    }

    @Override
    public Boolean insertByBo(TestDemoBo bo) {
        TestDemo add = MapstructUtils.convert(bo, TestDemo.class);
        validEntityBeforeSave(add);
        boolean flag = baseMapper.insert(add) > 0;
        if (flag) {
            bo.setId(add.getId());
        }
        return flag;
    }

    @Override
    public Boolean updateByBo(TestDemoBo bo) {
        TestDemo update = MapstructUtils.convert(bo, TestDemo.class);
        validEntityBeforeSave(update);
        return baseMapper.updateById(update) > 0;
    }

    @Override
    public Boolean deleteWithValidByIds(Collection<Long> ids, Boolean isValid) {
        if (isValid) {
            List<TestDemo> list = baseMapper.selectByIds(ids);
            if (list.size() != ids.size()) {
                throw new ServiceException("您没有删除权限!");
            }
        }
        return baseMapper.deleteByIds(ids) > 0;
    }

    private LambdaQueryWrapper<TestDemo> buildQueryWrapper(TestDemoBo bo) {
        Map<String, Object> params = bo.getParams();
        LambdaQueryWrapper<TestDemo> lqw = Wrappers.lambdaQuery();
        lqw.eq(bo.getDeptId() != null, TestDemo::getDeptId, bo.getDeptId());
        lqw.eq(bo.getUserId() != null, TestDemo::getUserId, bo.getUserId());
        lqw.like(StringUtils.isNotBlank(bo.getTestKey()), TestDemo::getTestKey, bo.getTestKey());
        lqw.eq(StringUtils.isNotBlank(bo.getValue()), TestDemo::getValue, bo.getValue());
        lqw.between(params.get("beginCreateTime") != null && params.get("endCreateTime") != null,
            TestDemo::getCreateTime, params.get("beginCreateTime"), params.get("endCreateTime"));
        lqw.orderByAsc(TestDemo::getId);
        return lqw;
    }

    private void validEntityBeforeSave(TestDemo entity) {
        // 数据校验逻辑
    }
}
```

**规范要点**:
- 使用 `@RequiredArgsConstructor` 和 Lombok 进行依赖注入
- 返回类型使用 `TableDataInfo<Vo>` 包装分页数据
- 使用 `MapstructUtils.convert()` 进行对象转换
- 使用 `LambdaQueryWrapper` 构建查询条件
- 在保存前进行数据校验
- 删除前进行权限校验

